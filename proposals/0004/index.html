<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width"><link rel=stylesheet href=https://hsd-dev.org/css/main.css><link rel=stylesheet href=https://hsd-dev.org/css/github-markdown.min.css><link rel=stylesheet href=/HIPs/css/style.css><title>Interactive Atomic Name Swaps - Handshake Improvement Proposals</title><link rel=icon type=image/x-icon href=https://handshake.org/img/favicon/hns-favicon.ico><title>Handshake Improvement Proposals</title><meta name=title content="Interactive Atomic Name Swaps"><meta name=description content="HIP-0004 - Category: Standards Track - Status: Draft"><meta name=author content="Matthew Zipkin <pinheadmz@gmail.com>"><meta property="og:type" content="website"><meta property="og:url" content="https://hsd-dev.org/HIPs/proposals/0004/"><meta property="og:title" content="Interactive Atomic Name Swaps"><meta property="og:description" content="HIP-0004 - Category: Standards Track - Status: Draft"><meta property="og:image" content="https://hsd-dev.org/img/logo.svg"><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://hsd-dev.org/HIPs/proposals/0004/"><meta property="twitter:title" content="Interactive Atomic Name Swaps"><meta property="twitter:description" content="HIP-0004 - Category: Standards Track - Status: Draft"><meta property="twitter:image" content="https://hsd-dev.org/img/logo.svg"></head><body><header><a href=/><img alt="Handshake logo" src=https://hsd-dev.org/img/logo.svg></a></header><main><nav><div class=wrapper><ul><li><strong>HIPs</strong></li><li><a href=/>Home</a></li><li><a href=/HIPs/proposals/>Proposals</a></li><li><a href=https://t.me/hns_tech>Tech Chat</a></li></ul><ul><li><strong class=upper>category</strong></li><li class=capitalize><a href=https://hsd-dev.org/HIPs/category/informational>Informational</a></li><li class=capitalize><a href=https://hsd-dev.org/HIPs/category/standards>Standards</a></li><li class=capitalize><a href=https://hsd-dev.org/HIPs/category/standards-track>Standards track</a></li></ul><ul><li><strong class=upper>status</strong></li><li class=capitalize><a href=https://hsd-dev.org/HIPs/status/draft>Draft</a></li><li class=capitalize><a href=https://hsd-dev.org/HIPs/status/final>Final</a></li></ul></div></nav><article class=page><section class=markdown-body><h2>HIP-0004: Interactive Atomic Name Swaps</h2><h2 id=abstract>Abstract</h2><p>We define a protocol by which two Handshake users can agree on a price for a HNS
domain name, and swap the name itself for payment in HNS using a single transaction.
The buyer and seller must be able to interact before and during the protocol, and
the final transaction is signed by both parties.</p><h2 id=motivation>Motivation</h2><p>HNS users need a decentralized, platform-less way to sell the domain names they&rsquo;ve
acquired form on-chain auctions. They need to be able to engage in trustless commerce
without third-party custodians to ensure censorship resistance and protect against
weak points of centralization.</p><h2 id=specification>Specification</h2><ul><li>Alice owns a name and agrees to sell it to Bob for a certain price (they communicate any way possible, not on-chain)</li><li>Bob sends Alice an address to receive the name</li><li>Alice signs and broadcasts a TRANSFER covenant committing to Bob&rsquo;s address<ul><li>At this point, Alice still unilaterally owns the name</li><li>Bob can see the TX on the blockchain (so can everyone) and confirm his address is in the covenant</li><li>At any time before the FINALIZE is broadcast, Alice can CANCEL the transfer<ul><li>Bob can see this CANCEL on chain (back to step 1)</li><li>No money or name is lost by either party if Alice decides to CANCEL, just the two mining fees so far spent by Alice</li></ul></li></ul></li><li>After 288 blocks a FINALIZE is valid, and is constructed cooperatively by both parties<ul><li>Alice can complete her end of the protocol at any time, but Bob can not broadcast the FINALIZE until after 288 blocks</li><li>Alice may decide to CANCEL if Bob doesn&rsquo;t complete the FINALIZE within a certain time<ul><li>This is not enforced by the blockchain, it&rsquo;s just something Alice can do, and should warn Bob about it in step 1</li></ul></li><li>Alice constructs and partially signs a FINALIZE that sends value to her own receive address, and consumes the TRANSFER covenant as an input<ul><li>This requires <code>SIGHASH_ANYONECANPAY | SIGHASH_SINGLEREVERSE</code> so that Bob can still add funds</li></ul></li><li>Alice sends the serialized, partially-signed FINALIZE to Bob as a hex string</li><li>Bob decodes the blob, and verifies what he can<ul><li>His address is in the TRANSFER covenant and the FINALIZE output is valid</li><li>Alice&rsquo;s signature is valid, and the value output to her address is the agreed price</li></ul></li><li>Bob adds funds to the TX inputs and adds a change output if necessary</li><li>Bob signs his inputs with <code>SIGHASH_ALL</code></li><li>Bob broadcasts the final transaction<ul><li>This action transfers the money to Alice and the name to Bob in the same TX</li><li>Once this TX is confirmed, no rollback of the swap is possible</li></ul></li></ul></li></ul><h2 id=implementation>Implementation</h2><p><a href=https://github.com/handshake-org/hsd/pull/500>https://github.com/handshake-org/hsd/pull/500</a></p><p><a href=https://github.com/kyokan/bob-wallet/pull/208>https://github.com/kyokan/bob-wallet/pull/208</a></p><hr><div class=info><strong>HIP:</strong><div>0004</div><strong>Status:</strong><div><a href=/status/draft>Draft</a></div><strong>Type:</strong><div><a href=/category/standards-track>Standards Track</a></div><strong>Created:</strong><div>Mon, 08 Feb 2021</div><strong>Last commit:</strong><div>Sun, 11 Sep 2022</div><strong>Author:</strong><div>Matthew Zipkin &lt;pinheadmz@gmail.com></div></div><hr><a href=https://github.com/handshake-org/HIPs/blob/master/HIP-0004.md>Edit on GitHub</a></div></section><aside><h2>Table of Contents</h2><nav id=TableOfContents><ul><li><a href=#abstract>Abstract</a></li><li><a href=#motivation>Motivation</a></li><li><a href=#specification>Specification</a></li><li><a href=#implementation>Implementation</a></li></ul></nav></aside></article></main><footer id=footer>Â©&nbsp;2021 Handshake Community<a rel=license href=http://creativecommons.org/licenses/by-sa/4.0/>(Creative
Commons Attribution-ShareAlike 4.0 International License)</a></footer></body></html>