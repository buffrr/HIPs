<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width"><link rel=stylesheet href=https://hsd-dev.org/css/main.css><link rel=stylesheet href=https://hsd-dev.org/css/github-markdown.min.css><link rel=stylesheet href=/HIPs/css/style.css><title>Extend reserve name claim period with hard fork - Handshake Improvement Proposals</title><link rel=icon type=image/x-icon href=https://handshake.org/img/favicon/hns-favicon.ico><title>Handshake Improvement Proposals</title><meta name=title content="Extend reserve name claim period with hard fork"><meta name=description content="HIP-0014 - Category: Standards - Status: Draft"><meta name=author content="Matthew Zipkin (@pinheadmz)"><meta property="og:type" content="website"><meta property="og:url" content="https://hsd-dev.org/HIPs/proposals/0014/"><meta property="og:title" content="Extend reserve name claim period with hard fork"><meta property="og:description" content="HIP-0014 - Category: Standards - Status: Draft"><meta property="og:image" content="https://hsd-dev.org/img/logo.svg"><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://hsd-dev.org/HIPs/proposals/0014/"><meta property="twitter:title" content="Extend reserve name claim period with hard fork"><meta property="twitter:description" content="HIP-0014 - Category: Standards - Status: Draft"><meta property="twitter:image" content="https://hsd-dev.org/img/logo.svg"></head><body><header><a href=/><img alt="Handshake logo" src=https://hsd-dev.org/img/logo.svg></a></header><main><nav><div class=wrapper><ul><li><strong>HIPs</strong></li><li><a href=/>Home</a></li><li><a href=/HIPs/proposals/>Proposals</a></li><li><a href=https://t.me/hns_tech>Tech Chat</a></li></ul><ul><li><strong class=upper>category</strong></li><li class=capitalize><a href=https://hsd-dev.org/HIPs/category/informational>Informational</a></li><li class=capitalize><a href=https://hsd-dev.org/HIPs/category/standards>Standards</a></li><li class=capitalize><a href=https://hsd-dev.org/HIPs/category/standards-track>Standards track</a></li></ul><ul><li><strong class=upper>status</strong></li><li class=capitalize><a href=https://hsd-dev.org/HIPs/status/draft>Draft</a></li><li class=capitalize><a href=https://hsd-dev.org/HIPs/status/final>Final</a></li></ul></div></nav><article class=page><section class=markdown-body><h2>HIP-0014: Extend reserve name claim period with hard fork</h2><h2 id=tweet-sized-abstract>Tweet-sized abstract</h2><ul><li>Important reserved names (about 1,000) stay reserved for 4 additional years, a total of 8.</li><li>The rest of the reserved names (about 89,000) become available for auctions after
4 years (no change)</li></ul><p>See the section &ldquo;Example opinions&rdquo; for better understanding.</p><h2 id=abstract>Abstract</h2><p>Handshake was launched with a set of reserved names that can be claimed by their
current legacy DNS owners using DNSSEC proofs. The <code>claimPeriod</code> was originally
set to exactly four years (<code>4 * 365 * 144 = 210,240</code> blocks) after which any of
the reserved names could be OPEN for an auction and acquired by the usual
bidding process. After a year and a half of HNS mainnet, the community has
decided that this timespan is not sufficient to onboard many of the legacy name
holders. In addition, allowing some names (like <code>.com</code>) to go up for auction
after only four years of mainnet may lead to reckless name collisions that will
not help the project move forward.</p><p>Extending the reserve name claim period requires a hard fork of the Handshake
blockchain. We propose a responsible mechanism for deploying such a hard fork,
which will extend the <code>claimPeriod</code> to EIGHT YEARS for a subset of
the reserved names. We call this hard fork &ldquo;Thumb Wrestle&rdquo;.</p><p>The scripts used to create the reserved names list is <a href=https://github.com/handshake-org/hs-names>hs-names</a>.</p><h2 id=community-support>Community Support</h2><p>Hard forks by definition require the entire ecosystem to upgrade their software
to stay in consensus. That means all miners, exchanges, wallets and services
must agree to the protocol change. The <code>claimPeriod</code> discussion has been in
progress since before mainnet launched. In addition to countless chats on
Telegram, IRC and Discord, several more formal discussions and documents have
been published:</p><p><a href=https://github.com/handshake-org/hsd/issues/294>How long should gTLDs be reserved? #294</a></p><p><a href=https://github.com/handshake-org/hsd/issues/301>name claims: allowing soft-fork to increase name reservation period. #301</a></p><p><a href=https://github.com/handshake-org/hsd/issues/645>Extend name claim period #645</a></p><p><a href=https://gist.github.com/Falci/04ee458066f6e1f3d7af36501b188e1d>HIP-XXXX by Falci</a></p><p><a href=https://github.com/befranz/HIPs/blob/master/HIP-xxxx-Extended-Claim-Period.md>HIP-XXXX by Befranz</a></p><h2 id=protocol-changes>Protocol Changes</h2><h3 id=reserved-name-claims>Reserved Name Claims</h3><p>The Handshake reserved names are associated with a set of classification flags
which we can use to apply different sets of rules.</p><h4 id=old-current-rules>Old (current) rules</h4><table><thead><tr><th>flag</th><th>human time</th><th>last CLAIM block</th><th>first OPEN block</th><th></th></tr></thead><tbody><tr><td>root</td><td>4 years</td><td>210,240</td><td>210,241</td><td>TLDs in ICANN root zone</td></tr><tr><td>top100</td><td>4 years</td><td>210,240</td><td>210,241</td><td>Alexa top 100 + high ranking SLDs</td></tr><tr><td>custom</td><td>4 years</td><td>210,240</td><td>210,241</td><td>Special HNS allocations by founders</td></tr><tr><td>(none)</td><td>4 years</td><td>210,240</td><td>210,241</td><td>All other Alexa top 100,000 names</td></tr></tbody></table><h4 id=new-proposed-rules>New (proposed) rules</h4><table><thead><tr><th>flag</th><th>human time</th><th>last CLAIM block</th><th>first OPEN block</th><th></th></tr></thead><tbody><tr><td>root</td><td>8 years</td><td>420,480</td><td>420,481</td><td><em>*</em></td></tr><tr><td>top100</td><td>8 years</td><td>420,480</td><td>420,481</td><td></td></tr><tr><td>custom</td><td>8 years</td><td>420,480</td><td>420,481</td><td></td></tr><tr><td>(none)</td><td>4 years</td><td>210,240</td><td>210,241</td><td>(no change)</td></tr></tbody></table><p><em>* It has also been discussed to NEVER allow these names to go to auction.
Since that protocol change can be deployed by a future soft fork, we defer
from this document.</em></p><h3 id=new-constants>New constants</h3><p>We define new consensus values required for upgraded full nodes, and explained
in the following sections:</p><p><code>FORK_ID_TREE_KEY</code>: (32 bytes) <code>0000000000000000000000000000000000000000000000000000000000000000</code></p><p><code>THUMBWRESTLE_FORK_ID</code>: (4 bytes, &ldquo;thum&rdquo; in ascii) <code>7468756d</code></p><p><code>NULL_FORK_ID</code>: (4 bytes) <code>00000000</code></p><p><code>extendedClaimPeriod</code>: (int) <code>420480</code></p><p><code>thumbwrestleActivationHeight</code>: (int) <code>210241</code></p><h3 id=replay-protection>Replay protection</h3><p>In the event of a contentious hard fork or minority hard fork with sufficient
hash rate to compete with the main chain, we add replay protection to the
protocol which prevents transactions from one chain being valid on the other.</p><p>After activation, the transaction message used in all signature and verification
operations will be prefixed by <code>THUMBWRESTLE_FORK_ID</code>. For example, a transaction
input signed with SIGHASH_ALL will commit to these data in this order, hashed with blake2b
and signed:</p><table><thead><tr><th>bytes</th><th>value</th></tr></thead><tbody><tr><td>4</td><td><code>0x7468756d</code> (fork ID)</td></tr><tr><td>4</td><td>version</td></tr><tr><td>32</td><td>blake2b(serialized prevouts)</td></tr><tr><td>32</td><td>blake2b(serialized sequences)</td></tr><tr><td>32</td><td>blake2b(input prevout hash)</td></tr><tr><td>4</td><td>blake2b(input prevout index)</td></tr><tr><td><em>(var)</em></td><td>input redeem script</td></tr><tr><td>8</td><td>input value</td></tr><tr><td>4</td><td>input sequence</td></tr><tr><td>32</td><td>blake2b(serialized outputs)</td></tr><tr><td>4</td><td>locktime</td></tr><tr><td>4</td><td>SIGHASH flag</td></tr></tbody></table><p>Note that this new signature digest algorithm does NOT apply to two types of
common transactions on the network:</p><ul><li><p>Reserved name claims: Obviously, they can not be replayed on a chain fork
where name claims are no longer allowed.</p></li><li><p>Airdrop proofs: These may be replayed on alternate chains but once the coins
are generated they can only be spent with a transaction valid on the chain.</p></li></ul><h3 id=light-client-fork-detection>Light client fork detection</h3><p>It is common for blockchain hard forks to be designed such that SPV clients
do not need to upgrade. By design they blindly follow the most-work chain
without the ability to verify any other consensus rules. Handshake has a
crucial role as a DNS root zone, and enables a special light client that only
resolves names and has no wallet functions. For these reasons, we require all
light name resolvers to upgrade as well. This protects the main chain from
collisions with a contentious or minority fork.</p><h4 id=fork-id-tree-insertion>Fork ID tree insertion</h4><p>Luckily, the activation block <code>210241</code> is also the first block after a tree
commitment:</p><pre tabindex=0><code>claimPeriod = 210240
thumbwrestleActivationHeight = claimPeriod + 1
thumbwrestleActivationHeight % treeInterval = 1
</code></pre><p>This is extremely convenient for hard-forking light clients.</p><p><strong>When block <code>210240</code> is confirmed, a new <code>treeRoot</code> will be computed by all full
nodes. That value will be committed in the header of block <code>210241</code>. Hard forking
full nodes MUST also insert the following key=>value pair into the Urkel Tree before
computing this new <code>treeRoot</code>:</strong></p><p><strong><code>FORK_ID_TREE_KEY</code> => <code>THUMBWRESTLE_FORK_ID</code></strong></p><p>Full nodes MUST ALWAYS be able to serve Urkel proofs for this value at the
<code>treeRoot</code> present in blocks <code>210241</code> to <code>210276</code>. Even if a user has executed
a tree compaction and erased stale tree data, they MUST save this proof in the
database and serve it when requested.</p><p>When light clients reach height <code>210241</code> they can request a proof for <code>FORK_ID_TREE_KEY</code>
from full node peers. If a valid proof is not returned with the <code>THUMBWRESTLE_FORK_ID</code>
value, the light client MUST reject the block as invalid and ban the peer.</p><h2 id=future-hard-forks>Future hard forks</h2><p>The use of a fork ID in transaction signatures can be reused for future hard forks.
Fork IDs can also continue to be committed to the Urkel tree at <code>FORK_ID_TREE_KEY</code>.
This key value is effectively a <code>nameHash</code> but it is effectively impossible for
any valid Handshake name to hash to that exact value. This gives it a special
metadata property, that can only be updated with a hard fork. The fork ID values
never need to appear anywhere on chain in any transaction, block, or p2p message.</p><h2 id=activation>Activation</h2><p>The new hard fork rules will be enforced starting at block <code>210241</code>.</p><p>The use of BIP9 has been discussed to ensure miner readiness and those details
may be added to this HIP in the future. BIP9 should not be considered an activation
mechanism like it usually is for soft forks, but can be added as an emergency abort
mechanism if a majority of miners have not upgraded their software in time.</p><h2 id=suggested-timeline>Suggested timeline</h2><table><thead><tr><th>hsd version</th><th>status</th><th>approximate date</th></tr></thead><tbody><tr><td>v5.0.0</td><td>Protocol changes, activation logic and BIP9 implemented</td><td>October 2022</td></tr><tr><td>v6.0.0</td><td>Hard fork rules locked in, activation removed</td><td>April 2023</td></tr><tr><td>v7.0.0</td><td>Thumb Wrestle epoch begins</td><td>October 2023</td></tr></tbody></table><h2 id=example-implementation>Example implementation</h2><p>This code was written for research purposes only while writing this proposal. It
should not be opened as a pull request until community consensus has settled.</p><p><a href=https://github.com/pinheadmz/hsd/tree/thumbwrestle-1>https://github.com/pinheadmz/hsd/tree/thumbwrestle-1</a></p><h2 id=notes-for-developers>Notes for developers</h2><p>The wallet SHOULD set <code>forkid</code> automatically assuming it is in sync and walletDB
is aware of the correct blockchain height. Eventually the hard fork will be
buried under enough proof-of-work that activation logic can be removed. Handshake
is now a hard-forking blockchain which means if you are signing transactions
in your own software, you will always need to set the current fork ID:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>mtx</span>.<span style=color:#a6e22e>forkid</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>consensus</span>.<span style=color:#a6e22e>THUMBWRESTLE_FORK_ID</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>mtx</span>.<span style=color:#a6e22e>sign</span>(<span style=color:#a6e22e>ring</span>);
</span></span></code></pre></div><h2 id=example-opinions>Example opinions</h2><p>If you think that 4 years is not long enough for <code>.com</code> to claim on HNS, you should
support this proposal.</p><p>If you think <code>.com</code> should be open for auction on HNS in about a year for anyone
to own and control, you should oppose this proposal.</p><p>If you think <code>.com</code> should NEVER be opened for auction on HNS, you should support
this proposal and also support a future soft fork as we approach the 8 year mark.</p><hr><div class=info><strong>HIP:</strong><div>0014</div><strong>Status:</strong><div><a href=/status/draft>Draft</a></div><strong>Type:</strong><div><a href=/category/standards>Standards</a></div><strong>Created:</strong><div>Mon, 20 Jun 2022</div><strong>Last commit:</strong><div>Sun, 11 Sep 2022</div><strong>Author:</strong><div>Matthew Zipkin (@pinheadmz)</div></div><hr><a href=https://github.com/handshake-org/HIPs/blob/master/HIP-0014.md>Edit on GitHub</a></div></section><aside><h2>Table of Contents</h2><nav id=TableOfContents><ul><li><a href=#tweet-sized-abstract>Tweet-sized abstract</a></li><li><a href=#abstract>Abstract</a></li><li><a href=#community-support>Community Support</a></li><li><a href=#protocol-changes>Protocol Changes</a><ul><li><a href=#reserved-name-claims>Reserved Name Claims</a></li><li><a href=#new-constants>New constants</a></li><li><a href=#replay-protection>Replay protection</a></li><li><a href=#light-client-fork-detection>Light client fork detection</a></li></ul></li><li><a href=#future-hard-forks>Future hard forks</a></li><li><a href=#activation>Activation</a></li><li><a href=#suggested-timeline>Suggested timeline</a></li><li><a href=#example-implementation>Example implementation</a></li><li><a href=#notes-for-developers>Notes for developers</a></li><li><a href=#example-opinions>Example opinions</a></li></ul></nav></aside></article></main><footer id=footer>©&nbsp;2021 Handshake Community<a rel=license href=http://creativecommons.org/licenses/by-sa/4.0/>(Creative
Commons Attribution-ShareAlike 4.0 International License)</a></footer></body></html>